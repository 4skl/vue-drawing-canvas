var VueCanvasDrawing=function(t){"use strict";function e(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function r(t){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?e(Object(n),!0).forEach((function(e){o(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):e(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function n(t,e,r,n,i,o,a){try{var s=t[o](a),u=s.value}catch(t){return void r(t)}s.done?e(u):Promise.resolve(u).then(n,i)}function i(t){return function(){var e=this,r=arguments;return new Promise((function(i,o){var a=t.apply(e,r);function s(t){n(a,i,o,s,u,"next",t)}function u(t){n(a,i,o,s,u,"throw",t)}s(void 0)}))}}function o(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var a=t.defineComponent({name:"VueDrawingCanvas",props:{width:{type:[String,Number],default:function(){return 600}},height:{type:[String,Number],default:function(){return 400}},image:{type:String,default:function(){return""}},eraser:{type:Boolean,default:function(){return!1}},color:{type:String,default:function(){return"#000000"}},lineWidth:{type:Number,default:function(){return 5}},lock:{type:Boolean,default:function(){return!1}},styles:{type:[Array,String,Object]},classes:{type:[Array,String,Object]},backgroundColor:{type:String,default:function(){return"#FFFFFF"}},backgroundImage:{type:String,default:function(){return null}},watermark:{type:Object}},data:function(){return{drawing:!1,offsetX:0,offsetY:0,context:null,images:[],strokes:[],trash:[]}},mounted:function(){this.setContext()},methods:{setContext:function(){var t=document.querySelector("#VueDrawingCanvas");this.context=this.context?this.context:t.getContext("2d"),this.setBackground(),this.save()},clear:function(){this.context.clearRect(0,0,this.width,this.height)},setBackground:function(){var t=this;return i(regeneratorRuntime.mark((function e(){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.clear(),t.context.fillStyle=t.backgroundColor,t.context.fillRect(0,0,t.width,t.height),!t.backgroundImage){e.next=9;break}return(r=new Image).src=t.backgroundImage,e.next=8,t.drawBackgroundImage(r);case 8:r.onload=e.sent;case 9:case"end":return e.stop()}}),e)})))()},drawBackgroundImage:function(t){var e=this;return i(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:e.context.drawImage(t,0,0,e.width,e.height),e.save();case 2:case"end":return r.stop()}}),r)})))()},getCoordinates:function(t){var e,r;if(t.touches&&t.touches.length>0){var n=document.querySelector("#VueDrawingCanvas").getBoundingClientRect();e=t.touches[0].clientX-n.left,r=t.touches[0].clientY-n.top}else e=t.offsetX,r=t.offsetY;return{x:e,y:r}},startDraw:function(t){if(!this.lock){this.drawing=!0,this.strokes=[];var e=this.getCoordinates(t);this.strokes.push({color:this.eraser?"white":this.color,width:this.lineWidth,x:e.x,y:e.y}),this.offsetX=e.x,this.offsetY=e.y}},drawLine:function(t,e,r,n){this.context.strokeStyle=t,this.context.lineWidth=e,this.context.lineJoin="round",this.context.beginPath(),this.context.moveTo(r.x,r.y),this.context.lineTo(n.x,n.y),this.context.closePath(),this.context.stroke(),this.save()},draw:function(t){if(this.drawing){this.context||this.setContext();var e=this.getCoordinates(t);this.drawLine(this.eraser?this.backgroundColor:this.color,this.lineWidth,{x:this.offsetX,y:this.offsetY},{x:e.x,y:e.y}),this.strokes.push({color:this.eraser?"white":this.color,width:this.lineWidth,x:e.x,y:e.y}),this.offsetX=e.x,this.offsetY=e.y}},stopDraw:function(){this.drawing&&(this.strokes.length>1&&this.images.push(this.strokes),this.drawing=!1,this.trash=[])},reset:function(){this.lock||(this.setBackground(),this.images=[],this.strokes=[],this.trash=[],this.save())},undo:function(){if(!this.lock){var t=this.images.pop();t&&(this.trash.push(t),this.redraw())}},redo:function(){if(!this.lock){var t=this.trash.pop();t&&(this.images.push(t),this.redraw())}},redraw:function(){var t=this;return i(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.setBackground().then((function(){var e;t.images.forEach((function(r){e=null;var n=r[0].color,i=r[0].width;t.context.strokeStyle=n,t.context.lineWidth=i,t.context.lineJoin="round",t.context.beginPath(),r.forEach((function(r){e?(t.context.lineTo(r.x,r.y),t.context.stroke()):(t.context.moveTo(r.x,r.y),e=r)}))})),t.save()}));case 2:case"end":return e.stop()}}),e)})))()},save:function(){var t=this;if(!this.watermark){var e=document.querySelector("#VueDrawingCanvas");return this.$emit("update:image",e.toDataURL()),e.toDataURL()}var r=document.querySelector("#VueDrawingCanvas"),n=document.createElement("canvas"),i=n.getContext("2d");if(n.width=this.width,n.height=this.height,i.drawImage(r,0,0,this.width,this.height),"Image"===this.watermark.type){var o=new Image;o.src=this.watermark.source,o.onload=function(){return i.drawImage(o,t.watermark.x,t.watermark.y,t.watermark.imageStyle.width,t.watermark.imageStyle.height),t.$emit("update:image",n.toDataURL()),n.toDataURL()}}else if("Text"===this.watermark.type){i.font=this.watermark.fontStyle.font,i.textAlign=this.watermark.fontStyle.textAlign,i.textBaseline=this.watermark.fontStyle.textBaseline;var a=this.watermark.x+Math.floor(this.watermark.fontStyle.width/2),s=this.watermark.y+Math.floor(this.watermark.fontStyle.lineHeight/2);return i.translate(a,s),i.rotate(this.watermark.fontStyle.rotate*Math.PI/180),i.translate(-1*a,-1*s),"stroke"===this.watermark.fontStyle.drawType?(i.strokeStyle=this.watermark.fontStyle.color,i.strokeText(this.watermark.source,this.watermark.x,this.watermark.y,this.watermark.fontStyle.width)):(i.fillStyle=this.watermark.fontStyle.color,i.fillText(this.watermark.source,this.watermark.x,this.watermark.y,this.watermark.fontStyle.width)),this.$emit("update:image",n.toDataURL()),n.toDataURL()}},isEmpty:function(){return!(this.images.length>0)}},render:function(){var e=this;return t.isVue2?t.h("canvas",r({attrs:{id:"VueDrawingCanvas",width:this.width,height:this.height},style:r({touchAction:"none"},this.styles),class:this.classes,on:{mousedown:function(t){return e.startDraw(t)},mousemove:function(t){return e.draw(t)},mouseup:function(t){return e.stopDraw(t)},mouseleave:function(t){return e.stopDraw(t)},touchstart:function(t){return e.startDraw(t)},touchmove:function(t){return e.draw(t)},touchend:function(t){return e.stopDraw(t)},touchleave:function(t){return e.stopDraw(t)},touchcancel:function(t){return e.stopDraw(t)}}},this.$props)):t.h("canvas",{id:"VueDrawingCanvas",height:this.height,width:this.width,style:this.styles,class:this.classes,onMousedown:function(t){return e.startDraw(t)},onMousemove:function(t){return e.draw(t)},onMouseup:function(t){return e.stopDraw(t)},onMouseleave:function(t){return e.stopDraw(t)},onTouchstart:function(t){return e.startDraw(t)},onTouchmove:function(t){return e.draw(t)},onTouchend:function(t){return e.stopDraw(t)},onTouchleave:function(t){return e.stopDraw(t)},onTouchcancel:function(t){return e.stopDraw(t)}})}});return function(t,e){void 0===e&&(e={});var r=e.insertAt;if(t&&"undefined"!=typeof document){var n=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===r&&n.firstChild?n.insertBefore(i,n.firstChild):n.appendChild(i),i.styleSheet?i.styleSheet.cssText=t:i.appendChild(document.createTextNode(t))}}("\n#VueDrawingCanvas[data-v-73e835f2] {\r\n    touch-action: none;\n}\r\n"),a.__scopeId="data-v-73e835f2",a}(VueDemi);